//////////////////////////////////////////////////////
// API for the CPU to access to the performance counters of the GPU
//////////////////////////////////////////////////////
extern start_timestamp;
extern finish_timestamp;

//////////////////////////////////////////////////////
// Minimym x coordinate of each box
//////////////////////////////////////////////////////
extern xmin_buffer;

//////////////////////////////////////////////////////
// Maximum x coordinate of each box
//////////////////////////////////////////////////////
extern xmax_buffer;

//////////////////////////////////////////////////////
// Minimym y coordinate of each box
//////////////////////////////////////////////////////
extern ymin_buffer;

//////////////////////////////////////////////////////
// Maximum y coordinate of each box
//////////////////////////////////////////////////////
extern ymax_buffer;

//////////////////////////////////////////////////////
// Absciss corrdinates of the vedges
//////////////////////////////////////////////////////
extern vedges_x_buffer;

//////////////////////////////////////////////////////
// Minimum y corrdinates of the vedges
//////////////////////////////////////////////////////
extern vedges_ymin_buffer;

//////////////////////////////////////////////////////
// Maximum y corrdinates of the vedges
//////////////////////////////////////////////////////
extern vedges_ymax_buffer;

//////////////////////////////////////////////////////
// Ordinate corrdinates of the hedges
//////////////////////////////////////////////////////
extern hedges_y_buffer;

//////////////////////////////////////////////////////
// Minimum x corrdinates of the hedges
//////////////////////////////////////////////////////
extern hedges_xmin_buffer;

//////////////////////////////////////////////////////
// Maximum x corrdinates of the hedges
//////////////////////////////////////////////////////
extern hedges_xmax_buffer;


//////////////////////////////////////////////////////
// Does the current box hit an edge
//////////////////////////////////////////////////////
extern hit_buffer;

//////////////////////////////////////////////////////
// Number of intersection
//////////////////////////////////////////////////////
extern inter_num_buffer;

//////////////////////////////////////////////////////
// Is the data valid
//////////////////////////////////////////////////////
extern valid_buffer;

print_endline() {
  let x = 10;
  printf(&x);
}

kernel(threadid, num_vedges, num_hedges) {
  if (valid_buffer[threadid]) {
    let found = 0;

    let index = 0;

    let xmin = xmin_buffer[threadid];
    let ymin = ymin_buffer[threadid];
    let xmax = xmax_buffer[threadid];
    let ymax = ymax_buffer[threadid];

    while ((found == 0) && (index < num_vedges)) {
      let ex = vedges_x_buffer[index];
      let eymin = vedges_ymin_buffer[index];
      let eymax = vedges_ymax_buffer[index];

      found =
        (xmin <= ex) && (ex <= xmax) && (
          ((eymin <= ymin) && (ymin <= eymax)) ||
          ((eymin <= ymax) && (ymax <= eymax))
        );

      index = index + 1;
    }

    index = 0;
    while ((found == 0) && (index < num_hedges)) {
      let ey = hedges_y_buffer[index];
      let exmin = hedges_xmin_buffer[index];
      let exmax = hedges_xmax_buffer[index];

      found =
        (ymin <= ey) && (ey <= ymax) && (
          ((exmin <= xmin) && (xmin <= exmax)) ||
          ((exmin <= xmax) && (xmax <= exmax))
        );

      index = index + 1;
    }

    hit_buffer[threadid] = found;
  }
}
